{{ 'checkout-recommendations.css' | asset_url | stylesheet_tag }}
<script src="{{ 'checkout-recommendations.js' | asset_url }}" defer></script>

{%- liquid
  assign recommendation_collection = block.settings.collection
  assign products_limit = block.settings.products_to_show | at_most: 12 | at_least: 2
-%}

<div class="checkout-recommendations" {{ block.shopify_attributes }}>
  <div class="checkout-recommendations__container">
    {%- if block.settings.heading != blank -%}
      <h2 class="checkout-recommendations__heading">{{ block.settings.heading | escape }}</h2>
    {%- endif -%}

    {%- if recommendation_collection != blank and recommendation_collection.products_count > 0 -%}
      <ul class="checkout-recommendations__grid" role="list">
        {%- for product in recommendation_collection.products limit: products_limit -%}
          <li class="checkout-recommendations__item">
            <a href="{{ product.url }}" class="checkout-recommendations__card" aria-label="{{ product.title | escape }}">
              <div class="checkout-recommendations__media-wrap">
                {%- if product.featured_image != blank -%}
                  {{
                    product.featured_image
                    | image_url: width: 720
                    | image_tag:
                      class: 'checkout-recommendations__media',
                      widths: '320, 480, 640, 720',
                      sizes: '(min-width: 990px) 25vw, (min-width: 750px) 33vw, 50vw',
                      alt: product.featured_image.alt | default: product.title,
                      loading: 'lazy'
                  }}
                {%- else -%}
                  {{ 'product-1' | placeholder_svg_tag: 'checkout-recommendations__media checkout-recommendations__media--placeholder' }}
                {%- endif -%}
              </div>

              <div class="checkout-recommendations__content">
                <h3 class="checkout-recommendations__title">{{ product.title | escape }}</h3>
                <p class="checkout-recommendations__price">{{ product.price | money }}</p>
              </div>
            </a>
          </li>
        {%- endfor -%}
      </ul>
    {%- elsif request.design_mode -%}
      <div class="checkout-recommendations__empty-state">
        Select a collection in app block settings to show recommendations.
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "Checkout Recommendations",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Checkout Recommendations"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Number of products",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection source"
    }
  ]
}
{% endschema %}
