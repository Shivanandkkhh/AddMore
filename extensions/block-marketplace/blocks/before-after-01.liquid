{% assign active_blocks = shop.metafields.marketplace.active_blocks.value %}
{% if active_blocks contains 'before-after-01' %}
<style>
  .before-after-slider-{{ block.id }} {
    position: relative;
    max-width: 1200px;
    margin: {{ block.settings.margin_top }}px auto {{ block.settings.margin_bottom }}px;
    overflow: hidden;
    line-height: 0;
  }
  .before-after-slider-{{ block.id }} img {
    width: 100%;
    height: auto;
    display: block;
  }
  .before-after-slider-{{ block.id }} .img-after {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    clip-path: polygon(0 0, 50% 0, 50% 100%, 0 100%);
  }
  .before-after-slider-{{ block.id }} .slider-input {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    z-index: 10;
    cursor: ew-resize;
    margin: 0;
  }
  .before-after-slider-{{ block.id }} .slider-line {
    position: absolute;
    top: 0;
    left: 50%;
    bottom: 0;
    width: 4px;
    background: #ffffff;
    z-index: 5;
    transform: translateX(-50%);
    pointer-events: none;
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
  }
  .before-after-slider-{{ block.id }} .slider-button {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 40px;
    height: 40px;
    background: #ffffff;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    z-index: 6;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }
  .before-after-slider-{{ block.id }} .slider-button::before {
    content: '';
    display: inline-block;
    width: 0; height: 0;
    border-top: 6px solid transparent; border-bottom: 6px solid transparent;
    border-right: 8px solid #333333; margin-right: 4px;
  }
  .before-after-slider-{{ block.id }} .slider-button::after {
    content: '';
    display: inline-block;
    width: 0; height: 0;
    border-top: 6px solid transparent; border-bottom: 6px solid transparent;
    border-left: 8px solid #333333; margin-left: 4px;
  }
</style>

<div class="before-after-slider-{{ block.id }}">
  <div class="img-before">
    {% if block.settings.image_before %}
      <img
        src="{{ block.settings.image_before | image_url: width: 1200 }}"
        alt="Before"
        width="1200"
        height="800"
        loading="lazy"
      >
    {% else %}
      {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
    {% endif %}
  </div>

  <div class="img-after" id="img-after-{{ block.id }}">
    {% if block.settings.image_after %}
      <img
        src="{{ block.settings.image_after | image_url: width: 1200 }}"
        alt="After"
        width="1200"
        height="800"
        loading="lazy"
      >
    {% else %}
      {{ 'lifestyle-2' | placeholder_svg_tag: 'placeholder-svg' }}
    {% endif %}
  </div>

  <div class="slider-line" id="slider-line-{{ block.id }}"></div>
  <div class="slider-button" id="slider-button-{{ block.id }}"></div>

  <input
    type="range"
    min="0"
    max="100"
    value="50"
    class="slider-input"
    oninput="
      document.getElementById('img-after-{{ block.id }}').style.clipPath = 'polygon(0 0, ' + this.value + '% 0, ' + this.value + '% 100%, 0 100%)';
      document.getElementById('slider-line-{{ block.id }}').style.left = this.value + '%';
      document.getElementById('slider-button-{{ block.id }}').style.left = this.value + '%';
    "
  >
</div>

{% else %}
{% if request.design_mode %}<div style="padding: 20px; background: #fff3cd; color: #856404; border: 1px solid #ffeeba; text-align: center; border-radius: 4px; margin: 10px 0;"><strong>⚠️ AddMore App: Block Not Activated</strong><br>Please activate this block in your AddMore App dashboard to use it.</div>{% else %}<style>div[data-shopify-editor-block] { display: none; margin: 0; padding: 0; }</style>{% endif %}
{% endif %}
{% schema %}
{
  "name": "Before/After Image",
  "target": "section",
  "settings": [
    { "type": "image_picker", "id": "image_after", "label": "Image 1 (Left/After)" },
    { "type": "image_picker", "id": "image_before", "label": "Image 2 (Right/Before)" },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 40,
      "label": "Margin Top",
      "unit": "px"
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 40,
      "label": "Margin Bottom",
      "unit": "px"
    }
  ]
}
{% endschema %}
